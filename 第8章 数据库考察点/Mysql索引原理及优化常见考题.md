# 考点聚焦

## Mysql索引

* 索引的原理、类型、结构
* 创建索引的注意事项，使用原则
* 如何排查和消除慢查询

高能预警：本章考点偏理论

# 什么是索引？

* 索引是数据表中一个或者多个列进行排序的数据结构
* 索引能够大幅提升检索速度（回顾下你所知道的查找结构）
* 创建、更新索引本身也会耗费空间和时间

# 什么是B-Tree?

查找结构进化史

线性查找：一个一个找；实现简单；太慢

二分查找：有序；简单；要求是有序的；插入特别慢O(n)

HASH：查询快；占用空间；不太适合存储大规模数据

二叉查找树：插入和查询很快(log(n))；无法存大规模数据；复杂度退化(直接退化成了线性结构)

平衡树：解决bst(二叉查找树)时间复杂度退化的问题，树是平衡的。但是依然无法解决节点太多，树高度非常深的问题。

多路查找树：一个父亲可以有多个孩子节点(度(阶)：指的是一个父亲节点最多能有几个孩子节点)；节点过多树高不会特别深

多路平衡查找树-  B-Tree

## 什么是B-Tree，为什么要使用B-Tree

* 多路平衡查找树（每个节点最多m(m>=2)个孩子，称为m阶或者度）
* 叶节点具有相同的深度
* 节点中的数据key从左到右是递增的

![B-Tree](Picture\B-Tree.png)

# B+Tree

## B+树是B-Tree的变形

* Mysql实际使用的B+Tree作为索引的数据结构

* 只在叶子节点带有指向记录的指针（为什么？可以增加树的度）

  问题：是不是树的度越多越好了呢？

* 叶子节点通过指针相连。为什么？实现范围查询

# Mysql创建索引类型

* 普通索引（CREATE INDEX）
* 唯一索引，索引列的值必须唯一（CREATE UNIQUE INDEX）
* 多列索引
* 主键索引（PRIMARY KEY），一个表只能有一个
* 全文索引（FULLTEXT INDEX），InnoDB不支持

# 常考题：什么时候创建索引？

## 建表的时候需要根据查询需求来创建索引

* 经常用作查询条件的字段(WHERE条件)
* 经常用作表连接的字段
* 经常出现在order by, group by之后的字段

# 创建索引有哪些需要注意的？

## 最佳实践

* 非空字段NOT NULL, Mysql很难对空值作查询优化

  **很多互联网公司的建表规范要求索引字段有默认值**

* 作为索引的字段需要区分度高，离散度大，作为索引的字段值尽量不要有大量相同值

* 索引的长度不要太长(比较耗费时间)

# 索引什么时候失效？

## 记忆口诀：模糊匹配、类型隐转、最左匹配

* 以%开头的LIKE语句，模糊搜索

* 出现隐式类型转换（在Python这种动态语言查询中需要注意）

* 没有满足最左前缀原则（想想为什么是最左匹配？）

  最左前缀原则就是说如果是多列索引的话，我们需要满足最左前缀才能利用上索引

# 什么是聚集索引和非聚集索引？

## 什么是聚集索引？什么是非聚集索引？

* 聚集还是非聚集指的是B+Tree叶节点存的是指针还是数据记录
* MyISAM索引和数据分离，使用的是非聚集索引
* InnoDB数据文件就是索引文件，主键索引就是聚集索引

# 聚集索引与辅助索引

辅助索引先找到主键以后再根据主键找到数据

区别是在B+Tree的叶节点存储数据还是指针

MyISAM索引是非聚集的，InnoDB主键索引是聚集索引

# 如何排查慢查询

## 慢查询通常是缺少索引，索引不合理或者业务代码实现导致

* show_query_log_file开启并且查询慢查询日志
* 通过explain排查索引问题
* 调整数据修改索引；业务代码层限制不合理访问

# 本章回顾

## 索引的原理是重点

* 索引的原理
* B+Tree的结构
* 不同索引的区别



